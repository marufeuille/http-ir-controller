#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>
#include <uri/UriBraces.h>

#include <EEPROM.h>

#include <IRremoteESP8266.h>
#include <IRsend.h>

#define N 2000 // 最大5000程度が目安 in ESP-WROOM-02
#define IRPIN 5
#define IRLEDPIN 14

struct CONFIG {
  char ssid[32];
  char pass[32];
};

ESP8266WebServer server(80);

// ac ir data
int ac_law = 22;
int ac_high = 28;
unsigned int ac_dumped[6][643] = { // My DAIKIN's ac
  { // 22
  494,360,537,330,542,329,542,329,542,330,517,25168,3563,1662,515,1228,516,356,515,356,511,356,515,1228,516,356,515,356,511,356,515,357,515,1228,512,359,517,1221,517,1227,516,355,517,1223,515,1228,515,1224,515,1228,515,1228,511,361,510,356,517,1227,516,355,490,381,513,354,517,355,517,354,517,355,490,381,490,382,512,361,485,382,515,356,490,1253,490,382,510,356,491,381,490,381,490,382,490,381,490,382,490,377,490,381,490,382,490,381,490,381,490,382,485,382,490,383,490,381,490,382,490,381,490,377,490,381,490,382,490,381,490,382,490,381,486,381,490,382,490,381,490,382,490,381,490,383,485,382,490,381,490,382,511,360,512,360,485,382,490,381,512,359,513,359,512,359,513,356,511,360,511,361,512,359,512,360,512,355,516,355,512,361,537,334,538,334,537,334,538,329,542,330,537,334,538,333,538,334,538,329,543,328,544,329,538,334,537,1201,542,330,542,329,542,330,537,334,538,334,537,334,538,329,542,329,542,330,537,334,538,334,537,334,538,329,542,330,542,329,542,329,538,334,537,334,538,334,537,330,512,359,539,1204,538,334,537,334,538,1201,537,334,538,334,537,334,538,334,537,329,543,329,538,333,538,334,537,334,539,333,539,328,539,332,539,334,538,333,538,334,538,333,538,329,538,334,537,334,538,334,537,334,538,329,539,332,540,332,539,332,539,334,538,329,542,330,537,334,538,334,537,334,512,359,538,329,538,334,512,1231,512,359,508,364,512,1226,513,1231,481,1262,481,34780,3554,1671,506,1237,506,361,508,364,507,364,508,1235,508,359,508,363,508,364,508,363,508,1235,508,359,508,1236,534,1209,508,359,508,1235,508,1235,509,1231,507,1236,506,1237,502,365,533,338,507,1236,508,364,508,363,504,363,535,337,507,364,508,363,504,369,502,365,507,365,506,365,508,364,503,368,503,369,503,363,508,364,508,363,504,368,503,368,504,1236,507,365,502,369,504,1235,508,1235,503,1240,504,363,508,364,507,364,533,338,504,1240,503,1235,508,364,503,1240,503,368,504,363,508,364,507,364,503,368,504,368,503,365,507,365,502,369,504,368,503,368,529,343,503,364,507,364,508,363,504,1239,504,368,503,1236,507,364,503,368,504,368,503,368,504,363,508,364,503,368,504,368,503,368,503,364,508,365,502,369,504,368,503,368,504,363,508,364,508,363,504,1239,504,1235,508,365,502,369,502,370,503,368,504,363,503,369,503,368,503,368,504,368,503,368,477,1262,503,1240,503,368,504,368,499,368,503,370,502,369,502,370,499,372,499,373,499,368,503,368,503,368,504,368,499,372,499,373,499,368,503,370,502,369,499,1244,499,1265,451,395,499,373,499,372,499,373,499,1239,477,1266,499,1244,499,395,450,422,472,399,472,400,472,394,477,395,477,394,473,399,473,398,474,398,447,421,477,395,472,399,447,424,473,399,472,1267,451,420,472,399,473,399,472,399,474,395,450,1293,472,399,472,
  },
  { // 23
  525,334,537,334,538,333,538,334,538,333,538,25146,3587,1637,537,1206,537,334,538,334,537,334,538,1201,537,334,538,334,537,334,538,333,538,1201,538,334,537,1200,543,1200,542,329,539,1200,542,1201,542,1201,538,1201,542,1201,542,329,538,334,537,1201,542,334,538,334,537,330,537,334,538,334,537,334,538,333,538,334,538,329,539,332,539,333,569,1169,544,307,560,334,537,334,538,334,537,334,538,334,537,334,533,334,538,333,538,334,537,334,538,334,537,334,533,334,538,334,537,334,538,333,538,334,537,334,538,329,538,334,537,334,538,334,537,334,538,333,538,329,538,334,537,334,538,334,537,334,538,334,537,330,537,334,538,333,538,334,538,333,538,334,537,330,537,334,565,307,537,334,538,333,538,334,538,333,538,329,538,334,537,334,538,334,537,334,538,334,537,330,537,334,538,333,538,334,539,332,539,333,539,328,539,332,539,334,538,333,538,1200,543,328,539,333,539,332,539,332,539,333,539,334,537,330,537,334,538,334,537,334,538,333,538,334,538,329,537,334,538,334,537,334,538,334,537,334,538,329,538,333,538,334,538,1201,542,333,538,334,533,1206,537,334,538,333,538,334,533,334,537,334,538,334,537,334,539,334,537,334,533,334,538,334,537,334,538,334,537,334,533,334,538,333,539,333,539,332,539,333,539,332,535,334,537,334,538,333,538,334,538,333,511,356,538,334,641,260,508,334,537,334,538,333,538,334,533,334,538,333,538,1201,542,334,538,329,537,1206,538,1201,542,1201,537,34728,3589,1635,539,1200,543,333,539,328,539,333,538,1200,543,333,539,332,539,329,538,334,537,1202,542,333,525,1214,538,1201,542,334,537,1201,538,1205,538,1201,542,1200,539,1204,537,334,539,333,539,1199,539,333,539,332,539,334,538,334,537,334,533,334,538,333,538,334,537,334,538,334,537,334,533,334,538,334,537,334,538,333,538,334,537,334,533,334,538,1201,542,334,537,334,538,1201,538,1201,542,1201,537,334,538,334,537,334,538,1201,542,1201,537,1201,542,334,538,1201,538,333,538,334,537,334,538,334,537,334,538,334,533,334,537,334,538,333,538,334,537,334,538,334,534,333,539,332,539,333,539,1199,544,329,538,1205,538,334,537,334,538,334,533,334,537,334,538,333,538,334,537,334,538,334,533,334,537,334,538,334,537,334,538,334,537,330,539,332,539,332,540,1199,544,1199,539,334,538,334,537,334,538,333,538,334,533,334,537,334,538,334,537,334,538,334,537,1201,538,1201,542,334,537,334,533,334,539,333,539,332,539,334,538,333,538,329,538,334,537,334,538,334,537,334,538,334,533,334,537,334,539,332,540,332,539,1201,538,1201,542,334,537,334,533,334,539,333,538,1201,542,1201,538,1205,538,334,537,334,538,334,537,330,537,334,538,333,538,334,537,334,538,329,538,334,537,334,538,334,537,334,539,332,540,327,540,1204,539,1199,544,332,535,334,537,334,538,333,538,1200,543,334,533,
  },
  { // 24
  475,382,490,377,490,381,489,381,490,382,490,25198,3535,1687,490,1253,490,382,512,359,490,381,486,1253,490,381,491,381,511,359,490,381,490,1249,490,381,490,1254,490,1253,490,381,489,1248,490,1253,513,1230,490,1249,490,1252,490,381,512,360,512,1226,490,382,490,381,490,382,490,381,512,359,490,382,485,382,512,359,490,382,490,381,512,360,512,1226,490,382,511,360,490,382,490,381,511,359,512,359,513,359,512,359,486,381,513,359,490,381,490,382,510,361,512,359,511,361,485,386,506,361,511,361,510,361,511,360,511,361,511,360,511,356,511,361,511,359,490,381,512,359,513,359,512,359,513,354,513,359,512,359,513,359,512,359,512,360,510,361,511,360,486,381,511,361,511,359,512,359,513,359,512,359,512,360,512,354,513,359,512,359,513,359,512,359,513,359,512,359,512,355,512,360,512,359,512,359,511,361,511,360,490,382,511,356,511,360,511,1232,511,361,511,360,511,356,511,361,510,361,511,360,511,361,511,360,511,361,506,361,511,360,511,361,510,360,512,359,512,359,513,359,512,359,508,359,513,359,512,359,511,361,510,1231,513,359,507,360,512,1231,512,359,512,360,512,359,512,359,511,356,511,361,511,360,511,361,511,360,511,361,510,361,506,361,511,360,511,361,511,360,511,359,513,359,512,359,512,355,512,360,512,359,512,359,513,359,512,359,513,359,512,359,508,359,513,359,510,361,511,360,511,361,511,359,512,359,513,354,517,1226,513,359,512,359,513,1226,512,1231,512,1231,511,34752,3561,1662,513,1231,512,359,512,359,513,354,513,1231,512,359,512,359,513,359,512,359,511,1228,511,360,511,1231,512,1227,516,355,512,1231,513,1230,513,1226,515,1227,512,1231,512,359,512,360,512,1226,513,359,512,359,512,360,512,359,512,359,511,356,511,361,511,360,511,361,511,360,511,361,510,361,511,356,511,360,511,361,511,360,511,361,511,360,511,1226,513,359,512,359,513,1230,511,1228,515,1227,512,359,512,359,513,359,512,359,513,359,512,359,508,1230,513,1231,510,361,511,360,511,356,513,359,512,359,513,359,511,360,511,361,510,361,511,356,511,360,511,361,511,360,511,361,511,360,511,1226,513,359,512,1231,512,359,513,359,512,355,512,359,512,360,512,359,512,359,513,359,512,355,512,359,513,359,512,359,513,359,512,359,512,355,512,359,513,359,512,1231,512,1227,515,356,512,360,510,361,511,360,511,361,511,360,511,361,511,356,511,360,511,361,510,1233,511,1227,511,359,513,359,512,359,512,360,512,359,512,359,513,354,513,359,512,359,513,359,512,359,513,359,512,359,508,359,512,359,511,361,511,360,511,1228,515,1228,511,361,510,361,511,360,511,361,511,1226,512,1231,512,1231,511,361,511,360,511,356,511,361,510,361,511,360,511,361,511,360,511,361,511,356,511,360,511,359,512,360,512,359,512,359,513,1226,512,360,512,1231,512,359,512,359,513,354,513,1231,512,359,512,
  },
  { // 25
  520,334,538,333,538,329,568,304,542,329,516,25174,3582,1640,538,1201,542,332,513,354,542,330,542,1201,537,333,539,332,538,334,537,334,538,1201,567,304,515,1227,537,1206,538,332,539,1204,538,1201,542,1199,538,1205,538,1204,538,333,538,329,517,1226,538,334,538,332,539,332,538,329,542,330,542,329,517,355,515,356,538,333,538,332,540,332,537,1202,515,360,538,328,543,328,517,355,512,359,538,334,537,334,538,334,537,332,540,332,512,355,517,354,517,355,512,359,538,334,537,334,538,332,539,328,517,354,596,276,517,354,538,334,537,334,538,334,537,330,542,332,512,359,540,327,543,329,512,359,513,359,594,277,538,334,537,334,538,329,515,356,511,361,511,359,513,359,537,334,538,334,537,334,538,332,539,328,517,354,542,330,537,334,538,334,537,334,538,329,542,329,543,327,517,355,542,329,542,330,537,334,538,334,537,333,539,332,538,329,542,1201,515,355,517,354,538,334,538,333,538,334,537,334,538,332,539,333,537,334,512,355,517,354,543,329,538,332,539,332,538,334,512,359,538,334,537,334,538,328,516,355,542,329,513,1231,537,334,538,332,539,1204,538,333,538,329,543,329,511,359,539,332,538,334,537,334,538,334,537,334,538,329,542,329,538,333,538,334,594,277,538,332,539,333,537,334,538,334,537,330,515,356,515,356,511,359,539,333,539,332,513,359,537,330,516,355,542,330,542,329,538,332,512,359,538,334,537,334,538,329,542,1204,538,329,542,330,542,1199,538,1205,538,1204,538,34726,3587,1635,542,1201,538,334,538,333,538,334,537,1200,542,329,517,355,515,356,538,334,511,1230,538,334,537,1201,542,1200,517,354,538,1206,537,1204,538,1201,542,1201,511,1231,537,334,538,333,538,1200,543,328,542,329,543,329,538,333,538,334,537,333,537,334,565,307,537,334,538,329,542,328,517,354,513,359,537,334,538,334,511,360,538,332,539,333,539,1199,542,330,542,329,511,1231,537,1206,564,1174,595,275,517,355,512,359,538,1205,538,334,537,330,567,1174,517,1227,537,334,538,332,539,332,538,334,537,330,542,334,537,330,542,328,516,355,538,334,537,334,538,333,538,334,537,333,539,328,542,1201,542,329,516,1226,538,333,538,334,537,330,542,329,542,328,544,328,542,329,542,329,516,356,538,333,538,332,539,333,591,280,538,329,542,334,538,329,542,328,517,1226,538,1204,539,332,538,334,537,334,538,333,590,277,516,356,515,355,539,332,538,334,537,334,538,1204,537,1201,542,330,542,328,517,354,513,359,537,334,538,334,537,334,538,332,539,328,542,329,542,330,542,329,568,304,537,333,537,334,538,333,538,334,538,1199,542,1201,542,330,537,334,538,334,537,332,540,1204,537,1201,542,1199,542,330,515,356,538,334,537,333,539,332,538,333,538,334,538,333,538,328,543,328,596,276,542,329,538,334,537,334,538,333,538,1200,542,1201,515,1226,539,333,537,334,538,334,564,1174,542,328,544,
  },
  { // 26 not work??
  520,334,538,333,538,332,539,328,542,330,517,25172,3587,1635,538,1206,537,333,539,332,539,332,538,1201,515,357,537,334,619,251,539,332,538,1205,538,334,538,1199,542,1201,538,334,537,1204,538,1201,542,1201,538,1204,537,1206,537,334,538,329,542,1201,538,334,537,334,538,332,539,333,537,329,543,329,542,329,542,330,537,334,538,334,537,334,538,1199,621,251,542,329,512,360,537,334,538,333,538,329,543,333,538,329,542,328,544,328,539,332,538,334,537,334,538,333,538,334,616,251,542,328,621,250,542,330,537,334,538,334,537,334,538,333,538,329,542,330,542,328,542,329,542,330,537,334,538,334,537,334,538,329,542,329,568,304,542,329,538,332,539,333,539,332,538,334,537,330,542,329,542,329,542,330,511,360,538,334,537,334,538,332,539,330,542,328,516,355,517,354,538,334,537,334,538,334,537,330,569,302,542,330,542,329,538,333,538,334,537,1204,538,334,538,329,542,329,569,303,537,334,538,334,537,334,538,329,542,329,543,327,544,328,539,332,539,333,539,328,542,334,537,334,538,329,542,329,516,356,538,333,538,334,537,1200,544,327,544,328,517,1226,538,333,538,334,564,307,538,329,542,330,516,355,538,334,537,334,538,333,538,329,542,330,542,328,543,328,539,333,537,334,538,334,620,233,582,307,538,329,569,303,542,329,620,252,619,251,539,332,538,334,537,329,543,329,542,329,542,330,537,334,538,334,537,334,538,328,568,303,542,1201,542,330,537,334,538,1204,539,1199,542,1201,515,34752,3562,1662,537,1200,544,327,543,329,542,329,542,1201,538,334,538,333,538,329,542,330,594,1147,539,333,539,1204,538,1201,542,329,542,1201,538,1205,538,1199,544,1200,537,1206,537,334,590,277,542,1201,538,334,537,334,538,333,538,329,543,329,542,329,538,334,537,334,538,334,537,334,538,329,569,302,543,329,538,333,538,334,537,334,538,329,569,303,542,1201,537,334,538,334,537,1200,543,1200,538,1201,542,329,542,329,543,329,542,329,542,1200,538,333,565,1174,542,1200,543,328,542,330,537,334,538,333,538,329,542,334,538,329,542,330,542,329,515,355,539,333,537,334,538,333,538,334,537,330,542,1201,538,333,538,1204,538,333,538,334,537,330,542,329,516,356,515,356,538,332,539,333,537,334,538,333,538,334,537,330,542,329,542,330,567,303,539,332,539,333,537,1201,542,1201,542,330,537,333,539,332,539,333,539,332,538,329,542,329,542,330,542,329,538,334,537,1204,539,1200,542,329,517,355,542,329,538,334,537,334,538,334,537,333,539,328,568,303,542,329,542,330,537,334,538,334,537,334,538,334,537,330,542,329,542,1200,643,1100,537,334,538,334,537,328,544,328,542,1201,537,1206,537,1204,538,329,542,330,517,354,542,330,537,334,538,334,537,334,538,329,542,329,542,328,544,328,539,332,539,333,537,334,538,334,537,1201,542,330,515,356,538,1204,537,334,538,334,537,1201,621,251,515,
  },
  { // 27 not work??
  495,355,542,329,542,329,513,359,512,359,538,25150,3557,1667,512,1227,515,356,511,361,512,359,512,1227,515,356,515,356,516,356,538,333,511,1231,512,359,538,1201,515,1228,511,361,641,1100,513,1226,517,1226,721,1022,511,1226,517,355,512,359,512,1231,538,329,517,355,516,355,542,330,512,359,512,359,513,354,542,330,517,354,542,330,517,354,512,1231,513,354,517,355,516,355,542,330,512,359,512,359,538,334,512,359,513,354,517,355,517,354,512,360,537,334,538,333,513,354,517,355,512,359,513,359,537,334,538,334,539,328,516,355,512,361,538,333,511,361,511,360,511,356,516,356,512,359,538,334,512,359,538,329,517,354,540,332,539,329,516,360,511,356,515,357,512,359,538,334,512,354,596,276,517,354,517,355,539,332,513,359,539,332,512,357,619,252,511,360,511,361,511,360,511,356,516,356,542,329,512,360,512,359,538,333,513,354,517,355,512,1231,512,359,540,332,539,329,621,251,511,360,538,334,537,329,517,355,517,354,538,334,647,251,512,328,517,359,539,329,511,361,511,360,538,329,542,330,517,354,542,330,512,359,512,1227,542,329,517,355,516,1227,537,330,542,334,538,329,517,354,513,359,539,332,513,354,517,359,512,357,542,329,511,360,511,361,537,330,515,361,511,356,512,359,512,360,512,359,512,359,538,329,542,330,512,359,513,359,539,334,537,330,542,329,515,356,595,277,511,359,512,356,516,359,512,356,516,356,537,334,538,1201,515,356,515,357,515,1228,537,1204,565,1174,517,34748,3589,1637,537,1204,539,334,511,356,516,356,515,1226,513,359,512,356,516,360,538,329,542,1200,539,332,539,1204,539,1200,512,359,538,1201,542,1201,517,1226,511,1232,538,1200,516,355,517,354,513,1231,512,359,512,355,517,354,517,355,512,359,513,360,620,234,555,330,515,356,515,356,511,361,538,333,538,329,516,356,542,329,515,357,510,361,538,334,510,1233,510,357,542,329,538,1204,539,1199,544,1199,513,359,512,359,538,334,539,1199,517,1226,513,359,538,1205,512,1227,515,356,538,334,512,359,512,355,517,359,512,355,517,354,538,334,512,359,538,329,517,355,516,355,512,359,513,359,512,359,538,1201,517,354,517,1227,512,355,542,333,538,329,517,355,512,359,538,334,512,359,617,255,512,359,538,329,517,354,513,359,512,359,513,354,517,355,516,355,544,328,512,1231,512,1231,537,330,517,354,617,255,512,359,538,334,512,355,516,355,517,354,513,359,512,360,538,1205,538,1199,517,355,512,359,513,359,512,359,513,354,544,328,516,355,512,360,539,332,539,329,542,334,538,329,542,330,537,334,511,361,537,334,511,356,515,1227,516,1227,537,330,542,334,512,355,516,355,512,1231,512,1227,517,1226,512,359,538,334,537,334,538,334,537,330,516,355,512,360,512,359,539,332,513,359,512,355,517,354,513,359,512,359,512,360,539,1199,542,1201,513,359,512,1231,512,355,517,354,517,1226,513,359,537,
  }
};


// heater ir data
int heater_law = 18;
int heater_high = 22;
unsigned int heater_dumped[5][643];

// power off
unsigned int off_dumped[641] = {
525,332,539,333,564,308,538,329,543,329,537,25148,3588,1637,542,1200,539,332,539,334,538,332,539,1200,543,328,539,333,539,332,539,329,543,1199,544,328,539,1199,544,1199,542,330,542,1201,537,1206,537,1201,517,1226,538,1206,510,357,567,304,542,1200,539,332,564,307,540,327,544,329,542,330,542,329,538,334,537,334,590,277,542,330,542,329,538,1205,538,329,542,329,543,329,538,333,538,334,537,334,565,307,537,330,543,328,539,333,539,332,539,329,543,333,538,329,542,330,537,334,538,334,537,334,538,329,569,302,543,329,538,333,538,334,537,330,542,329,542,330,568,303,538,334,539,332,539,332,565,302,596,276,539,334,537,334,538,334,537,334,538,329,542,329,568,304,537,334,538,334,537,334,538,329,517,355,542,329,538,333,538,334,538,333,538,329,542,330,542,329,538,334,539,328,543,328,544,327,544,329,511,361,537,334,563,309,563,308,538,1201,537,1206,538,333,538,329,542,330,542,329,538,334,537,334,538,329,542,330,543,328,539,332,539,334,538,334,589,278,542,329,542,330,537,334,538,333,538,329,543,329,542,329,539,1204,540,332,539,328,543,1201,538,334,537,330,542,334,537,330,542,329,617,255,537,334,538,333,540,327,544,329,538,334,537,334,538,334,537,330,542,329,538,334,537,334,538,333,538,329,542,330,539,332,539,333,539,334,537,334,538,329,542,329,538,334,538,333,538,329,542,330,542,329,596,276,539,334,537,334,538,1201,542,329,538,334,537,1201,542,1201,538,334,537,34728,3614,1611,538,1201,542,330,542,329,538,333,538,1201,542,330,542,329,538,333,538,334,537,1202,542,329,538,1205,539,1200,543,330,515,1228,537,1201,568,1176,537,1206,537,1201,542,330,537,334,538,1202,542,329,542,330,537,334,538,333,538,329,543,329,517,354,539,333,539,334,537,330,542,329,517,355,537,334,539,329,543,329,542,329,542,330,537,334,538,329,542,330,543,328,544,1201,537,1201,542,1201,538,334,537,334,590,282,537,330,542,1201,537,1206,538,329,542,1201,538,333,538,334,538,333,538,329,569,303,542,329,538,334,539,332,539,328,544,327,544,329,516,354,539,334,538,334,537,330,515,1228,537,334,538,1205,538,329,542,330,542,329,538,334,537,334,538,334,539,327,544,329,538,334,537,334,538,334,537,330,542,329,542,330,537,334,538,333,538,334,537,1202,539,1199,544,329,542,330,542,329,538,333,538,334,537,334,538,329,542,330,539,332,539,333,539,1199,544,1199,539,333,539,332,539,333,539,329,542,330,542,329,538,333,538,329,542,330,542,329,1410,333,538,334,537,330,542,329,542,330,542,329,569,1170,542,1201,542,329,569,303,537,334,538,329,542,1201,542,1201,538,1206,537,329,544,328,543,330,537,334,538,334,537,330,542,329,542,330,542,329,538,333,538,329,542,334,538,329,542,330,537,334,538,334,537,334,564,303,542,329,543,329,539,332,539,1200,544,329,542,
};

// HTML
#define HTML_HEADER "<!doctype html>"\
  "<html><head><meta charset=\"UTF-8\"/>"\
  "<meta name=\"viewport\" content=\"width=device-width\"/>"\
  "</head><body>"
#define HTML_FOOTER "</body></html>"

void setup() {
  
  Serial.begin(115200);
  EEPROM.begin(100);
  CONFIG buf;
  EEPROM.get<CONFIG>(0, buf);
  Serial.print("WIFI_SSID: "); 
  Serial.println(buf.ssid);
  Serial.print("WIFI_PASSWD: "); 
  Serial.println(buf.pass);

  WiFi.begin(buf.ssid, buf.pass);

  // Wait until WiFi is connected
  Serial.println("");
  while(WiFi.status() != WL_CONNECTED){
    delay(1000);
    Serial.print(".");
  }
  Serial.println("");
  Serial.println("Connected!");
  Serial.print("IP Address: ");
  Serial.println(WiFi.localIP());

  // Setup WebServer Handlers
  server.on("/", [](){
    String html = HTML_HEADER "<h1>It works!</h1>" HTML_FOOTER;
    server.send(200, "text/html", html);
  });

  server.on("/off", [](){
    String html = HTML_HEADER "<h1>AirConditioner Turned off</h1>" HTML_FOOTER;
    sendIRData(off_dumped, 641); 
    server.send(200, "text/html", html);
  });

  server.on(UriBraces("/{}/{}"), [](){
    Serial.println("air-con On");
    String mode = server.pathArg(0);
    int temp = server.pathArg(1).toInt();
    int code = 200;
    String html;
    if (mode.equals("ac")) {
      if (temp < ac_law || ac_high <= temp) {
        Serial.print("invalid temperature: ");
        Serial.println(temp);
        code = 500;
        html = HTML_HEADER "<h1>Invalid Temperature</h1>" HTML_FOOTER;
      }
      else {
        Serial.print("temperature is setting to ");
        Serial.println(temp - ac_law);
        sendIRData(ac_dumped[temp - ac_law], 643); 
        html = HTML_HEADER "<h1>Temperature is set to " + String(temp) + "</h1>" HTML_FOOTER;
      }
    }
    else if (mode.equals("heater")) {}
    server.send(code, "text/html", html);
  });

  pinMode(IRLEDPIN,OUTPUT);
  pinMode(13,OUTPUT);
  pinMode(5,INPUT);

  server.begin();
}

void loop() {
  server.handleClient();
}
void sendIRData(unsigned int  *data, int dataSize)
{
  unsigned int i=0,power=HIGH;

  digitalWrite(IRLEDPIN, LOW);
  
  while(i < dataSize)
  {
    if(power == HIGH)
    {
      long startedTime = micros();
      while(micros() - startedTime < data[i])
      {
        digitalWrite(IRLEDPIN, HIGH);
        delayMicroseconds(8);
        digitalWrite(IRLEDPIN, LOW);
        delayMicroseconds(13);
      }

      power = LOW;
    }else{
      digitalWrite(IRLEDPIN, LOW);
      delayMicroseconds(data[i]);
      power = HIGH;
    }
    i++;
  }

  digitalWrite(IRLEDPIN, LOW);
}